--1)
CREATE VIEW QTD_PROJ_PECA AS
SELECT FF.PID , COUNT(FF.JID) AS QTD
FROM FPJ FF
GROUP BY FF.PID
UNION
SELECT P.PID, 0
FROM PECA P
GROUP BY P.PID
HAVING NOT EXISTS(SELECT DISTINCT F.PID FROM FPJ F );

CREATE VIEW QTD_PECA_POR_PROJ AS
SELECT JID,PID AS PID_QTD, SUM(QTD) AS TOTAL_QTD
FROM FPJ
GROUP BY JID,PID;



CREATE VIEW QTD_PECA_TOTAL AS
SELECT FF.PID AS PID_T, SUM(FF.QTD) AS TOTAL
FROM FPJ FF
GROUP BY FF.PID
UNION
SELECT P.PID, 0
FROM PECA P
GROUP BY P.PID
HAVING NOT EXISTS(SELECT DISTINCT F.PID FROM FPJ F );


CREATE VIEW PARTIAL_QTD AS
SELECT *
FROM (QTD_PECA_TOTAL PT  JOIN QTD_PECA_POR_PROJ PPP ON PT.PID_T = PPP.PID_QTD);



SELECT *
FROM (PARTIAL_QTD PQ  JOIN QTD_PROJ_PECA  QPP ON PQ.PID_T = QPP.PID);

--2)
CREATE VIEW PROJETO_COM_PECA1 AS
SELECT JID,QTD
FROM FPJ
WHERE PID = (SELECT PID FROM PECA WHERE PNOME = 'peca1')

SELECT F1.JID
FROM FPJ F1
GROUP BY F1.JID
HAVING AVG(F1.QTD) >(SELECT MAX(F.QTD)
					FROM PROJETO PJ, FPJ F
					WHERE PJ.JID = F.jID AND PJ.JNOME = 'projeto1')

--3)

CREATE VIEW MIN_PECA AS
select PID, MIN(QTD) AS QTD
from fpj
GROUP BY PID;

CREATE VIEW MAX_PECA AS
select PID, MAX(QTD) AS QTD
from fpj
GROUP BY PID;



SELECT MP.PID,(SELECT P.PNOME FROM PECA P WHERE MP.PID = P.PID), MAX(MP.QTD), MIN(MP1.QTD)
FROM  MAX_PECA MP JOIN  MIN_PECA MP1 ON (MP.PID =  MP1.PID)
GROUP BY MP.PID;

--4)
CREATE VIEW F1_DISTR AS
select *
from fpj 
WHERE FID = 1

SELECT F.PID, (SELECT P.PNOME FROM PECA P WHERE F.PID = P.PID), MIN(F.QTD), MAX(F.QTD) 
FROM FPJ F JOIN  F1_DISTR F1 ON (F.FID <> F1.FID)
GROUP BY F.PID



